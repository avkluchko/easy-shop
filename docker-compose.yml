version: "3.4"

services:
    nginx:
        build:
            context: .
            target: nginx
        volumes:
            - ./public:/app/public:ro
        depends_on:
            - php
        ports:
            - "${NGINX_PORT:-80}:80"
        restart: always

    php:
        build:
            context: .
            target: symfony_php
#        user: "${USER_ID:-1000}:${GROUP_ID:-1000}"
        environment:
            COMPOSER_MEMORY_LIMIT: -1
        volumes:
            # The "cached" option has no effect on Linux but improves performance on Mac
            - ./:/app:rw,cached
            - ./docker/php/conf.d/symfony.dev.ini:/usr/local/etc/php/conf.d/symfony.ini
            - php_socket:/var/run/php
            - composer:/root/.composer/cache
            # If you develop on Mac you can remove the var/ directory from the bind-mount
            # for better performance by enabling the next line
            - /app/var/cache
#        depends_on:
#            - database
        restart: always

volumes:
    db-data:
    composer:
    php_socket:
